


<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e40af">
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> ุซุงูููุฉ ุงููุฌุฑ ุงูุฃูููุฉ ููุจูุงุช</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>


    <style>
  

        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');
        
        * {
            font-family: 'Tajawal', sans-serif;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .receipt {
            width: 80mm;
            padding: 10mm;
            margin: 0 auto;
            border: 1px dashed #000;
        }
 
@media print {
  /* ุฅุฎูุงุก ูู ุดูุก */
  body * {
    visibility: hidden !important;
    height: 0 !important;
    overflow: hidden !important;
  }

  /* ุฅุธูุงุฑ ููุท ุงููุตูุงุช */
  #receipt-preview,
  #receipt-preview * {
    visibility: visible !important;
    overflow: visible !important;
    height: auto !important;
    font-weight: bold !important; /* <-- ุชู ุฅุถุงูุฉ ุชุบููู ุงูุฎุท */
  }

  /* ุถุจุท ุญุงููุฉ ุงููุตูุงุช */
  #receipt-preview {
    position: absolute;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    display: flex !important;
    flex-direction: row;
    justify-content: space-between;
    align-items: flex-start;
    padding: 1cm;
    box-sizing: border-box;
    gap: 1cm;
    page-break-before: avoid;
    page-break-after: avoid;
    page-break-inside: avoid;
  }

  #receipt-preview > div {
    width: 49%;
    border: 2px dashed black;
    padding: 0.5cm;
    box-sizing: border-box;
    font-size: 11px;
    height: auto;
  }

  @page {
    size: A4 landscape;
    margin: 0;
  }

  html, body {
    margin: 0 !important;
    padding: 0 !important;
    height: 100%;
    overflow: hidden;
  }

  img {
    max-width: 100%;
    height: auto;
  }
}


    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen flex flex-col">
        <header class="bg-green-900 text-white shadow-lg">
            <div class="container mx-auto px-5 py-5">
                <h1 class="text-2xl md:text-3xl font-bold text-center"> ุซุงูููุฉ ุงููุฌุฑ ุงูุฃูููุฉ - ููุจูุงุช</h1>
            </div>
        </header>
        
 

<style>
@keyframes gradient-x {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
.animate-gradient {
  background: linear-gradient(-45deg, #3b82f6, #a855f7, #ec4899, #22d3ee);
  background-size: 400% 400%;
  animation: gradient-x 10s ease infinite;
}
</style>


<style>
@keyframes gradient-x {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
.animate-gradient {
  background: linear-gradient(270deg, #3b82f6, #a855f7, #ec4899, #22d3ee);
  background-size: 400% 400%;
  animation: gradient-x 10s ease infinite;
}
.animate-gradient-dropdown {
  background: linear-gradient(270deg, #06b6d4, #3b82f6, #8b5cf6, #ec4899);
  background-size: 600% 600%;
  animation: gradient-x 8s ease infinite;
}
</style>

<nav class="relative text-white shadow-lg animate-gradient">
  <div class="container mx-auto px-4 py-4 flex justify-start relative">
    <div class="relative">
      <button id="dropdown-btn" class="bg-green-700 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-2xl shadow-md focus:outline-none">
        ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ
      </button>
      <div id="dropdown-menu" class="hidden absolute top-0 right-full mr-4 flex flex-row space-x-0 space-y-0 text-white rounded-lg shadow-lg z-50 animate-gradient-dropdown">
        <button class="px-4 py-2 whitespace-nowrap hover:bg-white/10 transition-colors duration-300" data-tab="add-student">โ ุฅุถุงูุฉ ุทุงูุจุฉ</button>
        <button class="px-4 py-2 whitespace-nowrap hover:bg-white/10 transition-colors duration-300" data-tab="pay-fees">๐ฐ ุชุณุฏูุฏ ุงูุฃูุณุงุท</button>
        <button class="px-4 py-2 whitespace-nowrap hover:bg-white/10 transition-colors duration-300" data-tab="statistics">๐ ุงูุฅุญุตุงุฆูุงุช</button>
        <button class="px-4 py-2 whitespace-nowrap hover:bg-white/10 transition-colors duration-300" data-tab="fees-data">๐ ุจูุงูุงุช ุงูุฃูุณุงุท ุญุณุจ ุงูุตู</button>
        <button class="px-4 py-2 whitespace-nowrap hover:bg-white/10 transition-colors duration-300" data-tab="payment-reports">๐ ุชูุงุฑูุฑ ุฏูุน ุงูุฃูุณุงุท</button>
        <button class="px-4 py-2 whitespace-nowrap hover:bg-white/10 transition-colors duration-300" data-tab="support">๐๏ธ ุงูุฏุนู</button>
      </div>
    </div>
  </div>
</nav>

<script>
  const dropdownBtn = document.getElementById('dropdown-btn');
  const dropdownMenu = document.getElementById('dropdown-menu');
  dropdownBtn.addEventListener('click', () => {
    dropdownMenu.classList.toggle('hidden');
  });
  dropdownMenu.querySelectorAll('button[data-tab]').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.getElementById(btn.dataset.tab).classList.add('active');
      dropdownMenu.classList.add('hidden');
    });
  });
</script>



        
        <main class="flex-grow container mx-auto px-4 py-6">
            <!-- ุฅุถุงูุฉ ุทุงูุจ -->
            <div id="add-student" class="tab-content active">
                <div class="bg-white rounded-lg shadow-md p-6 max-w-4xl mx-auto">
                    <h2 class="text-xl font-bold mb-6 text-blue-800 border-b pb-2">ุฅุถุงูุฉ ุทุงูุจุฉ ุฌุฏูุฏุฉ</h2>
                    
                    <form id="student-form" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 mb-2">ุงุณู ุงูุทุงูุจุฉ</label>
                                <input type="text" id="student-name" class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 mb-2">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
                                <input type="email" id="student-email" class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 mb-2">ุงูุตู</label>
                                <select id="student-grade" class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    <option value="">ุงุฎุชุฑ ุงูุตู</option>
                                    <option value="ุฃูู ูุชูุณุท">ุฃูู ูุชูุณุท</option>
                                    <option value="ุซุงูู ูุชูุณุท">ุซุงูู ูุชูุณุท</option>
                                    <option value="ุซุงูุซ ูุชูุณุท">ุซุงูุซ ูุชูุณุท</option>
                                    <option value="ุซุงูุซ ุฎุงุฑุฌู">ุซุงูุซ ุฎุงุฑุฌู</option>
                                    <option value="ุฑุงุจุน ุนููู">ุฑุงุจุน ุนููู</option>
                                    <option value="ุฑุงุจุน ุฃุฏุจู">ุฑุงุจุน ุฃุฏุจู</option>
                                    <option value="ุฎุงูุณ ุนููู">ุฎุงูุณ ุนููู</option>
                                    <option value="ุฎุงูุณ ุฃุฏุจู">ุฎุงูุณ ุฃุฏุจู</option>
                                    <option value="ุณุงุฏุณ ุนููู">ุณุงุฏุณ ุนููู</option>
                                    <option value="ุณุงุฏุณ ุฃุฏุจู">ุณุงุฏุณ ุฃุฏุจู</option>
                                    <option value="ุณุงุฏุณ ุฎุงุฑุฌู">ุณุงุฏุณ ุฎุงุฑุฌู</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 mb-2">ุงูุดุนุจุฉ</label>
                                <select id="student-section" class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    <option value="">ุงุฎุชุฑ ุงูุดุนุจุฉ</option>
                                    <option value="ุฃ">ุฃ</option>
                                    <option value="ุจ">ุจ</option>
                                    <option value="ุฌ">ุฌ</option>
                                    <option value="ุฏ">ุฏ</option>
                                    <option value="ูู">ูู</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 mb-2">ุงููุจูุบ ุงูููู (ุฏููุงุฑ)</label>
                                <input type="number" id="student-total-amount" class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 mb-2">ุงูุฎุตู </label>
                                <input type="number" id="student-discount" class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" min="0" max="500000" value="0">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 mb-2">ููุงุญุธุงุช</label>
                            <textarea id="student-notes" class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3"></textarea>
                        </div>
                        
                        <div class="flex justify-between pt-4">
                            <div class="flex gap-2">
        <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition">ุฅุถุงูุฉ ุงูุทุงูุจุฉ</button>
        <button id="edit-student-btn" class="bg-yellow-500 text-white px-6 py-2 rounded-md hover:bg-yellow-600 transition" disabled>ุชุนุฏูู</button>
    </div>
                            
                        </div>
                    </form>
                </div>
                
                <div class="mt-8 bg-white rounded-lg shadow-md p-6 max-w-4xl mx-auto overflow-x-auto">
                    
<div class="flex justify-between items-center mb-4">
  <h3 class="text-lg font-bold text-blue-800 border-b pb-2">ูุงุฆูุฉ ุงูุทุงูุจุงุช</h3>
  <input type="text" id="student-list-search" placeholder="ุงุจุญุซ ุนู ุทุงูุจุฉ..." class="border px-3 py-1 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
</div>

                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr>
                                
                                <th class="px-4 py-2 text-right">ุงุณู ุงูุทุงูุจุฉ</th>
                                <th class="px-4 py-2 text-right">ุงูุตู</th>
                                <th class="px-4 py-2 text-right">ุงูุดุนุจุฉ</th>
                                <th class="px-4 py-2 text-right">ุงููุจูุบ ุงูููู</th>
                                <th class="px-4 py-2 text-right">ุงูุฎุตู</th>
                                <th class="px-4 py-2 text-right">ุงููุจูุบ ุจุนุฏ ุงูุฎุตู</th>
                                <th class="px-4 py-2 text-right">ุงููุฏููุน</th>
                                <th class="px-4 py-2 text-right">ุงููุชุจูู</th>
                                <th class="px-4 py-2 text-right">ุฅุฌุฑุงุกุงุช</th>
                            </tr>
                        </thead>
                        <tbody id="students-table-body" class="divide-y divide-gray-200">
</tbody>
<div id="pagination-controls" class="mt-4"></div>
                            <!-- ุณูุชู ุฅุถุงูุฉ ุงูุทูุงุจ ููุง -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- ุชุณุฏูุฏ ุงูุฃูุณุงุท -->
            <div id="pay-fees" class="tab-content">
                <div class="bg-white rounded-lg shadow-md p-6 max-w-4xl mx-auto">
                    <h2 class="text-xl font-bold mb-6 text-blue-800 border-b pb-2">ุชุณุฏูุฏ ุงูุฃูุณุงุท</h2>
                    
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-3">ุงูุจุญุซ ุนู ุทุงูุจุฉ</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-gray-700 mb-2">ุงุณู ุงูุทุงูุจุฉ</label>
                                <input type="text" id="search-name" class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 mb-2">ุงูุตู</label>
                                <select id="search-grade" class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">ุงููู</option>
                                    <option value="ุฃูู ูุชูุณุท">ุฃูู ูุชูุณุท</option>
                                    <option value="ุซุงูู ูุชูุณุท">ุซุงูู ูุชูุณุท</option>
                                    <option value="ุซุงูุซ ูุชูุณุท">ุซุงูุซ ูุชูุณุท</option>
                                    <option value="ุซุงูุซ ุฎุงุฑุฌู">ุซุงูุซ ุฎุงุฑุฌู</option>
                                    <option value="ุฑุงุจุน ุนููู">ุฑุงุจุน ุนููู</option>
                                    <option value="ุฑุงุจุน ุฃุฏุจู">ุฑุงุจุน ุฃุฏุจู</option>
                                    <option value="ุฎุงูุณ ุนููู">ุฎุงูุณ ุนููู</option>
                                    <option value="ุฎุงูุณ ุฃุฏุจู">ุฎุงูุณ ุฃุฏุจู</option>
                                    <option value="ุณุงุฏุณ ุนููู">ุณุงุฏุณ ุนููู</option>
                                    <option value="ุณุงุฏุณ ุฃุฏุจู">ุณุงุฏุณ ุฃุฏุจู</option>
                                    <option value="ุณุงุฏุณ ุฎุงุฑุฌู">ุณุงุฏุณ ุฎุงุฑุฌู</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 mb-2">ุงูุดุนุจุฉ</label>
                                <select id="search-section" class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">ุงููู</option>
                                    <option value="ุฃ">ุฃ</option>
                                    <option value="ุจ">ุจ</option>
                                    <option value="ุฌ">ุฌ</option>
                                    <option value="ุฏ">ุฏ</option>
                                    <option value="ูู">ูู</option>
                                </select>
                            </div>
                        </div>
                        
                        <button id="search-btn" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition">ุจุญุซ</button>
                    </div>
                    
                    <div id="search-results" class="mt-6 hidden">
                        <h3 class="text-lg font-semibold mb-3">ูุชุงุฆุฌ ุงูุจุญุซ</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead>
                                    <tr>
                                        <th class="px-4 py-2 text-right">ุงุณู ุงูุทุงูุจุฉ</th>
                                        <th class="px-4 py-2 text-right">ุงูุตู</th>
                                        <th class="px-4 py-2 text-right">ุงูุดุนุจุฉ</th>
                                        <th class="px-4 py-2 text-right">ุงููุจูุบ ุจุนุฏ ุงูุฎุตู</th>
                                        <th class="px-4 py-2 text-right">ุงููุฏููุน</th>
                                        <th class="px-4 py-2 text-right">ุงููุชุจูู</th>
                                        <th class="px-4 py-2 text-right">ุฅุฌุฑุงุกุงุช</th>
                                    </tr>
                                </thead>
                                <tbody id="search-results-body" class="divide-y divide-gray-200">
                                    <!-- ุณูุชู ุฅุถุงูุฉ ูุชุงุฆุฌ ุงูุจุญุซ ููุง -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div id="payment-form" class="mt-8 hidden">
                        <h3 class="text-lg font-semibold mb-3">ุชุณุฏูุฏ ูุณุท</h3>
                        <div class="p-4 bg-gray-50 rounded-lg mb-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <p><span class="font-semibold">ุงุณู ุงูุทุงูุจุฉ:</span> <span id="payment-student-name"></span></p>
                                    <p><span class="font-semibold">ุงูุตู:</span> <span id="payment-student-grade"></span></p>
                                    <p><span class="font-semibold">ุงูุดุนุจุฉ:</span> <span id="payment-student-section"></span></p>
                                </div>
                                <div>
                                    <p><span class="font-semibold">ุงููุจูุบ ุงูููู:</span> <span id="payment-total-amount"></span> ุฏููุงุฑ</p>
                                    <p><span class="font-semibold">ุงูุฎุตูู:</span> <span id="payment-student-discount"></span> ุฏููุงุฑ</p>
                                    <p><span class="font-semibold">ุงููุจูุบ ุงูููู ุจุนุฏ ุงูุฎุตู:</span> <span id="payment-total-after-discount"></span> ุฏููุงุฑ</p>
                                    <p><span class="font-semibold">ุงููุจูุบ ุงููุฏููุน:</span> <span id="payment-paid-amount"></span> ุฏููุงุฑ</p>
                                    <p><span class="font-semibold">ุงููุจูุบ ุงููุชุจูู:</span> <span id="payment-remaining-amount"></span> ุฏููุงุฑ</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold mb-3">ุฅุถุงูุฉ ุฏูุนุฉ ุฌุฏูุฏุฉ</h4>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 mb-2">ุงููุจูุบ (ุฏููุงุฑ)</label>
                                        <input type="number" id="payment-amount" class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 mb-2">ุฑูู ุงููุตู</label>
                                        <input type="text" id="payment-receipt-number" class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 mb-2">ุชุงุฑูุฎ ุงูุฏูุน</label>
                                        <input type="date" id="payment-date" class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    </div>
                                    
                                    
<div>
    <label class="block text-gray-700 mb-2">ุฑูู ุงูุฏูุนุฉ</label>
    <select id="payment-installment-number" class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
        <option value="">ุงุฎุชุฑ ุงูุฏูุนุฉ</option>
        <option value="1">ุงูุฏูุนุฉ ุงูุงููู</option><option value="2">ุงูุฏูุนุฉ ุงูุซุงููุฉ</option><option value="3">ุงูุฏูุนุฉ ุงูุซุงูุซุฉ</option><option value="4">ุงูุฏูุนุฉ ุงูุฑุงุจุนุฉ</option><option value="5">ุงูุฏูุนุฉ ุงูุฎุงูุณุฉ</option><option value="6">ุงูุฏูุนุฉ ุงูุณุงุฏุณุฉ</option><option value="7">ุงูุฏูุนุฉ ุงูุณุงุจุนุฉ</option><option value="8">ุงูุฏูุนุฉ ุงูุซุงููุฉ</option><option value="9">ุงูุฏูุนุฉ ุงูุชุงุณุนุฉ</option><option value="10">ุงูุฏูุนุฉ ุงูุนุงุดุฑุฉ</option><option value="11">ุงูุฏูุนุฉ ุงูุญุงุฏูุฉ ุนุดุฑ</option><option value="12">ุงูุฏูุนุฉ ุงูุซุงููุฉ ุนุดุฑ</option><option value="13">ุงูุฏูุนุฉ ุงูุซุงูุซุฉ ุนุดุฑ</option><option value="14">ุงูุฏูุนุฉ ุงูุฑุงุจุนุฉ ุนุดุฑ</option><option value="15">ุงูุฏูุนุฉ ุงูุฎุงูุณุฉ ุนุดุฑ</option>
    </select>
</div>

                                    <div>
                                        <button id="add-payment-btn" class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 transition">ุฅุถุงูุฉ ุงูุฏูุนุฉ</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-3">ุณุฌู ุงูุฏูุนุงุช</h4>
                                <div class="overflow-y-auto max-h-64 border rounded-md">
                                   <table class="min-w-full divide-y divide-gray-200">
  <thead class="bg-gray-50">
    <tr>
      <th class="px-4 py-2 text-right">ุงูุชุงุฑูุฎ</th>
      <th class="px-4 py-2 text-right">ุงููุจูุบ</th>
      <th class="px-4 py-2 text-right">ุฑูู ุงูุฏูุนุฉ</th>
      <th class="px-4 py-2 text-right">ุฑูู ุงููุตู</th>
      <th class="px-4 py-2 text-right">ุงูุฅุฌุฑุงุกุงุช</th>
    </tr>
  </thead>
  <tbody id="payment-history" class="divide-y divide-gray-200">
    <!-- ุณูุชู ุฅุถุงูุฉ ุณุฌู ุงูุฏูุนุงุช ููุง -->
  </tbody>
</table>
                                </div>
                            </div>
                        </div>
                        
                    <div class="mt-6 border-t pt-4">
    <h4 class="font-semibold mb-3">ุทุจุงุนุฉ ูุฅุฑุณุงู ุงููุตู</h4>
<!-- ุญุงููุฉ ุงููุตููู ุจุตู ุฃููู -->
<div id="receipt-preview" class="flex flex-row justify-between gap-2 print:gap-2 px-2 py-2">


  <!-- ุงููุตู ุงูุฃูู -->
  <div class="w-1/2 border print:border print:border-dashed print:border-black p-6 text-sm">

    <!-- ุงูุฑุฃุณ -->
    <div class="flex justify-between items-center mb-4 border-b pb-2">
      <div class="w-1/3 text-right">
        <h3 class="text-lg font-bold">ุซุงูููุฉ ุงููุฌุฑ ุงูุฃูููุฉ ููุจูุงุช</h3>
      </div>
      <div class="w-1/3 text-center">
        <img src="logoo.jpg" alt="" class="w-18 h-18 mx-auto">
      </div>
      <div class="w-1/3 text-left">
        <p><strong>ุฑูู ุงููุตู:</strong> <span id="receipt-number"></span></p>
        <p><strong>ุฑูู ุงูุฏูุนุฉ:</strong> <span id="receipt-installment"></span></p>
        <p><strong>ุงูุชุงุฑูุฎ:</strong> <span id="receipt-date"></span></p>
      </div>
    </div>

    <!-- ุนููุงู ุงููุตู -->
    <h2 class="text-center text-base font-bold mb-4">
      <span class="inline-block pb-1 border-b-2 border-black">ูุตู ูุจุถ</span>
    </h2>

<!-- ุฌุฏูู: ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ -->
<table class="w-full mb-4 border border-black text-center table-fixed">
  <thead>
    <tr class="bg-gray-100">
      <th class="border border-black p-2 font-bold">ุงุณู ุงูุทุงูุจุฉ</th>
      <th class="border border-black p-2 font-bold">ุงูุตู</th>
      <th class="border border-black p-2 font-bold">ุงูุดุนุจุฉ</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="border border-black p-2" id="receipt-student-name"></td>
      <td class="border border-black p-2" id="receipt-student-grade"></td>
      <td class="border border-black p-2" id="receipt-student-section"></td>
    </tr>
  </tbody>
</table>

<!-- ุฌุฏูู: ุชูุงุตูู ุงููุจูุบ ูุงูุฎุตู -->
<table class="w-full mb-4 border border-black text-center table-fixed">
  <thead>
    <tr class="bg-gray-100">
      <th class="border border-black p-2 font-bold">ุงููุจูุบ ุงูููู</th>
      <th class="border border-black p-2 font-bold">ุงูุฎุตู</th>
      <th class="border border-black p-2 font-bold">ุงููุจูุบ ุจุนุฏ ุงูุฎุตู</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="border border-black p-2"><span id="receipt-total"></span> ุฏููุงุฑ</td>
      <td class="border border-black p-2"><span id="receipt-student-discount"></span> ุฏููุงุฑ</td>
      <td class="border border-black p-2"><span id="receipt-total-after-discount"></span> ุฏููุงุฑ</td>
    </tr>
  </tbody>
</table>

<!-- ุฌุฏูู: ุงููุจูุบ ุงููุฏููุน -->
<table class="w-full mb-4 border border-black text-center table-fixed">
  <thead>
    <tr class="bg-gray-100">
      <th class="border border-black p-2 font-bold">ุงููุจูุบ ุงููุฏููุน</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="border border-black p-2"><span id="receipt-amount"></span> ุฏููุงุฑ</td>
    </tr>
  </tbody>
</table>

<!-- ุฌุฏูู: ููุฎุต ุงูุญุณุงุจ -->
<table class="w-full mb-4 border border-black text-center table-fixed">
  <thead>
    <tr class="bg-gray-100">
      <th class="border border-black p-2 font-bold">ุฅุฌูุงูู ุงููุฏููุน</th>
      <th class="border border-black p-2 font-bold">ุฅุฌูุงูู ุงููุชุจูู</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="border border-black p-2"><span id="receipt-total-paid"></span> ุฏููุงุฑ</td>
      <td class="border border-black p-2"><span id="receipt-remaining"></span> ุฏููุงุฑ</td>
    </tr>
  </tbody>
</table>


    <!-- ุงูุชุฐููู -->
    <div class="text-center text-sm border-t pt-2">
      <p>ุดุงุฑุน ูุทุนู ุฑุจูุน ุงูุดุงู - ููุงุจู ููุชุจุฉ ุฃุณุชุงุฐ ููุตูุฑ</p>
      <p class="mt-2">ูุชููู ููู ุงูุชูููู ูุงููุฌุงุญ ุงูุฏุงุฆู</p>
      <p class="mt-2">07757444357</p>
    </div>
  </div>
<!-- ุงููุตู ุงูุซุงูู -->
<div class="w-1/2 border print:border print:border-dashed print:border-black p-6 text-sm">

  <!-- ุงูุฑุฃุณ -->
  <div class="flex justify-between items-center mb-4 border-b pb-2">
    <div class="w-1/3 text-right">
      <h3 class="text-lg font-bold">ุซุงูููุฉ ุงููุฌุฑ ุงูุฃูููุฉ ููุจูุงุช</h3>
    </div>
    <div class="w-1/3 text-center">
      <img src="logoo.jpg" alt="" class="w-18 h-18 mx-auto">
    </div>
    <div class="w-1/3 text-left">
      <p><strong>ุฑูู ุงููุตู:</strong> <span id="receipt-number-copy"></span></p>
        <p><strong>ุฑูู ุงูุฏูุนุฉ:</strong> <span id="receipt-installment-copy"></span></p>
      <p><strong>ุงูุชุงุฑูุฎ:</strong> <span id="receipt-date-copy"></span></p>
    </div>
  </div>

  <!-- ุนููุงู ุงููุตู -->
  <h2 class="text-center text-base font-bold mb-4">
    <span class="inline-block pb-1 border-b-2 border-black">ูุตู ูุจุถ</span>
  </h2>

  <!-- ุฌุฏูู: ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ -->
  <table class="w-full mb-4 border border-black text-center table-fixed">
    <thead>
      <tr class="bg-gray-100">
        <th class="border border-black p-2 font-bold">ุงุณู ุงูุทุงูุจุฉ</th>
        <th class="border border-black p-2 font-bold">ุงูุตู</th>
        <th class="border border-black p-2 font-bold">ุงูุดุนุจุฉ</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="border border-black p-2" id="receipt-student-name-copy"></td>
        <td class="border border-black p-2" id="receipt-student-grade-copy"></td>
        <td class="border border-black p-2" id="receipt-student-section-copy"></td>
      </tr>
    </tbody>
  </table>

  <!-- ุฌุฏูู: ุชูุงุตูู ุงููุจูุบ ูุงูุฎุตู -->
  <table class="w-full mb-4 border border-black text-center table-fixed">
    <thead>
      <tr class="bg-gray-100">
        <th class="border border-black p-2 font-bold">ุงููุจูุบ ุงูููู</th>
        <th class="border border-black p-2 font-bold">ุงูุฎุตู</th>
        <th class="border border-black p-2 font-bold">ุงููุจูุบ ุจุนุฏ ุงูุฎุตู</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="border border-black p-2"><span id="receipt-total-copy"></span> ุฏููุงุฑ</td>
        <td class="border border-black p-2"><span id="receipt-student-discount-copy"></span> ุฏููุงุฑ</td>
        <td class="border border-black p-2"><span id="receipt-total-after-discount-copy"></span> ุฏููุงุฑ</td>
      </tr>
    </tbody>
  </table>

  <!-- ุฌุฏูู: ุงููุจูุบ ุงููุฏููุน -->
  <table class="w-full mb-4 border border-black text-center table-fixed">
    <thead>
      <tr class="bg-gray-100">
        <th class="border border-black p-2 font-bold">ุงููุจูุบ ุงููุฏููุน</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="border border-black p-2"><span id="receipt-amount-copy"></span> ุฏููุงุฑ</td>
      </tr>
    </tbody>
  </table>

  <!-- ุฌุฏูู: ููุฎุต ุงูุญุณุงุจ -->
  <table class="w-full mb-4 border border-black text-center table-fixed">
    <thead>
      <tr class="bg-gray-100">
        <th class="border border-black p-2 font-bold">ุฅุฌูุงูู ุงููุฏููุน</th>
        <th class="border border-black p-2 font-bold">ุฅุฌูุงูู ุงููุชุจูู</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="border border-black p-2"><span id="receipt-total-paid-copy"></span> ุฏููุงุฑ</td>
        <td class="border border-black p-2"><span id="receipt-remaining-copy"></span> ุฏููุงุฑ</td>
      </tr>
    </tbody>
  </table>

  <!-- ุงูุชุฐููู -->
  <div class="text-center text-sm border-t pt-2">
    <p>ุดุงุฑุน ูุทุนู ุฑุจูุน ุงูุดุงู - ููุงุจู ููุชุจุฉ ุฃุณุชุงุฐ ููุตูุฑ</p>
    <p class="mt-2">ูุชููู ููู ุงูุชูููู ูุงููุฌุงุญ ุงูุฏุงุฆู</p>
    <p class="mt-2">07757444357</p>
  </div>
</div>
</div>


                            <div class="flex flex-wrap gap-2">
                                <button id="print-receipt-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition">
                                    <i class="fas fa-print mr-1"></i> ุทุจุงุนุฉ ุงููุตู
                                </button>
                                <button id="email-receipt-btn" class="bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 transition">
                                    <i class="fas fa-envelope mr-1"></i> ุฅุฑุณุงู ุงููุตู ุจุงูุจุฑูุฏ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
           
            <!-- ุงูุฅุญุตุงุฆูุงุช -->
            <div id="statistics" class="tab-content">
                <div class="bg-white rounded-lg shadow-md p-6 max-w-4xl mx-auto">
                    <h2 class="text-xl font-bold mb-6 text-blue-800 border-b pb-2">ุงูุฅุญุตุงุฆูุงุช</h2>
                     <div class="mb-6 grid grid-cols-1 md:grid-cols-3 gap-4">
    <div>
        <label class="block text-gray-700 mb-2">ุงูุตู</label>
        <select id="filter-grade" class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">ุงููู</option>
            <option value="ุฃูู ูุชูุณุท">ุฃูู ูุชูุณุท</option>
            <option value="ุซุงูู ูุชูุณุท">ุซุงูู ูุชูุณุท</option>
            <option value="ุซุงูุซ ูุชูุณุท">ุซุงูุซ ูุชูุณุท</option>
            <option value="ุซุงูุซ ุฎุงุฑุฌู">ุซุงูุซ ุฎุงุฑุฌู</option>
            <option value="ุฑุงุจุน ุนููู">ุฑุงุจุน ุนููู</option>
            <option value="ุฑุงุจุน ุฃุฏุจู">ุฑุงุจุน ุฃุฏุจู</option>
            <option value="ุฎุงูุณ ุนููู">ุฎุงูุณ ุนููู</option>
            <option value="ุฎุงูุณ ุฃุฏุจู">ุฎุงูุณ ุฃุฏุจู</option>
            <option value="ุณุงุฏุณ ุนููู">ุณุงุฏุณ ุนููู</option>
            <option value="ุณุงุฏุณ ุฃุฏุจู">ุณุงุฏุณ ุฃุฏุจู</option>
            <option value="ุณุงุฏุณ ุฎุงุฑุฌู">ุณุงุฏุณ ุฎุงุฑุฌู</option>
        </select>
    </div>
    <div>
        <label class="block text-gray-700 mb-2">ุงูุดุนุจุฉ</label>
        <select id="filter-section" class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">ุงููู</option>
            <option value="ุฃ">ุฃ</option>
            <option value="ุจ">ุจ</option>
            <option value="ุฌ">ุฌ</option>
            <option value="ุฏ">ุฏ</option>
            <option value="ูู">ูู</option>
        </select>
    </div>
    <div class="flex items-end">
        <button onclick="updateStatistics()" class="w-full bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition">ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช</button>
    </div>
</div>

                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <h3 class="text-lg font-semibold text-blue-800 mb-2">ุนุฏุฏ ุงูุทุงูุจุงุช</h3>
                            <p class="text-3xl font-bold" id="total-students">0</p>
                        </div>
                        
                        <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                            <h3 class="text-lg font-semibold text-green-800 mb-2">ุฅุฌูุงูู ุงููุจุงูุบ</h3>
                            <p class="text-3xl font-bold" id="total-fees">0 ุฏููุงุฑ</p>
                        </div>
                        
                        <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                            <h3 class="text-lg font-semibold text-purple-800 mb-2">ุฅุฌูุงูู ุงููุฏููุน</h3>
                            <p class="text-3xl font-bold" id="total-paid">0 ุฏููุงุฑ</p>
                        </div>
                        
                        <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                            <h3 class="text-lg font-semibold text-yellow-800 mb-2">ุฅุฌูุงูู ุงููุชุจูู</h3>
                            <p class="text-3xl font-bold" id="total-remaining">0 ุฏููุงุฑ</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div>
                            <h3 class="text-lg font-semibold mb-4">ูุณุจุฉ ุงูุชุญุตูู</h3>
                            <div class="aspect-square">
                                <canvas id="collection-chart"></canvas>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold mb-4">ุชูุฒูุน ุงูุทุงูุจุงุช ุญุณุจ ุงูุตู</h3>
                            <div class="aspect-square">
                                <canvas id="grades-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-semibold mb-4">ุชูุฒูุน ุงูุทุงูุจุงุช ุญุณุจ ุงูุดุนุจุฉ</h3>
                        <div class="h-64">
                            <canvas id="sections-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ุงูุฏุนู -->
            <div id="support" class="tab-content">
                <div class="bg-white rounded-lg shadow-md p-6 max-w-4xl mx-auto">
                    <h2 class="text-xl font-bold mb-6 text-blue-800 border-b pb-2">ุงูุฏุนู ูุงููุณุฎ ุงูุงุญุชูุงุทู</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-4">ุงููุณุฎ ุงูุงุญุชูุงุทู</h3>
                            <p class="mb-4 text-gray-600">ูู ุจุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ุจูุงูุงุช ุงููุธุงู ููุญูุงุธ ุนูููุง.</p>
                            <button id="backup-btn" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition mb-2 w-full">ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ</button>
                            <p class="text-sm text-gray-500 mb-6">ุณูุชู ุชูุฒูู ููู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุนูู ุฌูุงุฒู.</p>
                            
                            <h3 class="text-lg font-semibold mb-4">ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ</h3>
                            <p class="mb-4 text-gray-600">ูู ุจุงุณุชุนุงุฏุฉ ุจูุงูุงุช ุงููุธุงู ูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ุณุงุจูุฉ.</p>
                            <div class="mb-4">
                                <input type="file" id="restore-file" class="hidden" accept=".json">
                                <label for="restore-file" class="block w-full bg-gray-200 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-300 transition text-center cursor-pointer">ุงุฎุชูุงุฑ ููู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ</label>
                                <p id="selected-file-name" class="mt-2 text-sm text-gray-500">ูู ูุชู ุงุฎุชูุงุฑ ููู</p>
                            </div>
                            <button id="restore-btn" class="bg-yellow-600 text-white px-6 py-2 rounded-md hover:bg-yellow-700 transition w-full" disabled>ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ</button>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold mb-4">ุชุตุฏูุฑ ุงูุจูุงูุงุช</h3>
                            <p class="mb-4 text-gray-600">ูู ุจุชุตุฏูุฑ ุจูุงูุงุช ุงููุธุงู ุฅูู ููู Excel.</p>
                            <div class="space-y-3">
                                <button id="export-students-btn" class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 transition w-full">ุชุตุฏูุฑ ุจูุงูุงุช ุงูุทุงูุจุงุช</button>
                                <button id="export-payments-btn" class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 transition w-full">ุชุตุฏูุฑ ุจูุงูุงุช ุงูุฏูุนุงุช</button>
                                <button id="export-all-btn" class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 transition w-full">ุชุตุฏูุฑ ุฌููุน ุงูุจูุงูุงุช</button>
                            </div>
                            
                            <h3 class="text-lg font-semibold mt-8 mb-4">ูุณุญ ุงูุจูุงูุงุช</h3>
                            <p class="mb-4 text-gray-600">ุงุญุฐุฑ! ุณูุคุฏู ูุฐุง ุงูุฅุฌุฑุงุก ุฅูู ุญุฐู ุฌููุน ุงูุจูุงูุงุช ูู ุงููุธุงู.</p>
                            <button id="clear-data-btn" class="bg-red-600 text-white px-6 py-2 rounded-md hover:bg-red-700 transition w-full">ูุณุญ ุฌููุน ุงูุจูุงูุงุช</button>
                        </div>
                    </div>
                </div>
            </div>
        
<!-- ุจูุงูุงุช ุงูุฃูุณุงุท -->
<div id="fees-data" class="tab-content">
    <div class="bg-white rounded-lg shadow-md p-6 max-w-6xl mx-auto">
        <h2 class="text-xl font-bold mb-6 text-blue-800 border-b pb-2">ุจูุงูุงุช ุงูุฃูุณุงุท </h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <div>
                <label class="block text-gray-700 mb-2">ุงูุตู</label>
                <select id="fees-grade-filter" class="w-full border rounded-md px-3 py-2">
                    <option value="">ุงููู</option>
                    <option value="ุฃูู ูุชูุณุท">ุฃูู ูุชูุณุท</option>
                    <option value="ุซุงูู ูุชูุณุท">ุซุงูู ูุชูุณุท</option>
                    <option value="ุซุงูุซ ูุชูุณุท">ุซุงูุซ ูุชูุณุท</option>
                    <option value="ุฑุงุจุน ุนููู">ุฑุงุจุน ุนููู</option>
                    <option value="ุฑุงุจุน ุฃุฏุจู">ุฑุงุจุน ุฃุฏุจู</option>
                    <option value="ุฎุงูุณ ุนููู">ุฎุงูุณ ุนููู</option>
                    <option value="ุฎุงูุณ ุฃุฏุจู">ุฎุงูุณ ุฃุฏุจู</option>
                    <option value="ุณุงุฏุณ ุนููู">ุณุงุฏุณ ุนููู</option>
                    <option value="ุณุงุฏุณ ุฃุฏุจู">ุณุงุฏุณ ุฃุฏุจู</option>
                    <option value="ุซุงูุซ ุฎุงุฑุฌู">ุซุงูุซ ุฎุงุฑุฌู</option>
                    <option value="ุณุงุฏุณ ุฎุงุฑุฌู">ุณุงุฏุณ ุฎุงุฑุฌู</option>
                </select>
            </div>
            <div>
                <label class="block text-gray-700 mb-2">ุงูุดุนุจุฉ</label>
                <select id="fees-section-filter" class="w-full border rounded-md px-3 py-2">
                    <option value="">ุงููู</option>
                    <option value="ุฃ">ุฃ</option>
                    <option value="ุจ">ุจ</option>
                    <option value="ุฌ">ุฌ</option>
                    <option value="ุฏ">ุฏ</option>
                    <option value="ูู">ูู</option>
                </select>
            </div>
            <div class="flex items-end">
                <button onclick="filterFeesData()" class="w-full bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition">ุชุตููุฉ</button>
            </div>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 text-sm">
                <thead>
                    <tr class="bg-gray-100 text-right">
                        <th class="px-4 py-2 text-right">#</th>
                        <th class="px-4 py-2">ุงุณู ุงูุทุงูุจุฉ</th>
                        <th class="px-4 py-2">ุงูุตู</th>
                        <th class="px-4 py-2">ุงูุดุนุจุฉ</th>
                        <th class="px-4 py-2">ุงููุจูุบ ุจุนุฏ ุงูุฎุตู</th>
                        <th class="px-4 py-2">ุงููุฏููุน</th>
                        <th class="px-4 py-2">ุงููุชุจูู</th>
                        <th class="px-4 py-2">ุชุงุฑูุฎ ุขุฎุฑ ูุจูุบ ูุฏููุน</th>
                    </tr>
                </thead>
                <tbody id="fees-data-body" class="divide-y divide-gray-100">
                    <!-- ุณูุชู ููุก ุงูุจูุงูุงุช ุฏููุงููููุงู -->
                </tbody>
            </table>
        </div>
    </div>
</div>


<!-- ุชูุงุฑูุฑ ุฏูุน ุงูุฃูุณุงุท -->
<div id="payment-reports" class="tab-content">
  <div class="bg-white rounded-lg shadow-md p-6 max-w-6xl mx-auto">
    <h2 class="text-xl font-bold mb-6 text-blue-800 border-b pb-2">ุชูุงุฑูุฑ ุฏูุน ุงูุฃูุณุงุท</h2>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
      <div>
        <label class="block text-gray-700 mb-2">ุงูุตู</label>
        <select id="report-grade" class="w-full border rounded-md px-3 py-2">
          <option value="">ุงููู</option>
          <option value="ุฃูู ูุชูุณุท">ุฃูู ูุชูุณุท</option>
          <option value="ุซุงูู ูุชูุณุท">ุซุงูู ูุชูุณุท</option>
          <option value="ุซุงูุซ ูุชูุณุท">ุซุงูุซ ูุชูุณุท</option>
          <option value="ุฑุงุจุน ุนููู">ุฑุงุจุน ุนููู</option>
          <option value="ุฑุงุจุน ุฃุฏุจู">ุฑุงุจุน ุฃุฏุจู</option>
          <option value="ุฎุงูุณ ุนููู">ุฎุงูุณ ุนููู</option>
          <option value="ุฎุงูุณ ุฃุฏุจู">ุฎุงูุณ ุฃุฏุจู</option>
          <option value="ุณุงุฏุณ ุนููู">ุณุงุฏุณ ุนููู</option>
          <option value="ุณุงุฏุณ ุฃุฏุจู">ุณุงุฏุณ ุฃุฏุจู</option>
          <option value="ุซุงูุซ ุฎุงุฑุฌู">ุซุงูุซ ุฎุงุฑุฌู</option>
          <option value="ุณุงุฏุณ ุฎุงุฑุฌู">ุณุงุฏุณ ุฎุงุฑุฌู</option>
        </select>
      </div>
      <div>
        <label class="block text-gray-700 mb-2">ุงูุดุนุจุฉ</label>
        <select id="report-section" class="w-full border rounded-md px-3 py-2">
          <option value="">ุงููู</option>
          <option value="ุฃ">ุฃ</option>
          <option value="ุจ">ุจ</option>
          <option value="ุฌ">ุฌ</option>
          <option value="ุฏ">ุฏ</option>
          <option value="ูู">ูู</option>
        </select>
      </div>
      <div>
        <label class="block text-gray-700 mb-2">ุงูุญุงูุฉ</label>
        <select id="report-status" class="w-full border rounded-md px-3 py-2">
          <option value="all">ุงููู</option>
          <option value="paid">ุงูุฏุงูุนูู ูุฐุง ุงูุดูุฑ</option>
          <option value="unpaid">ุบูุฑ ุงูุฏุงูุนูู ูุฐุง ุงูุดูุฑ</option>
        </select>
      </div>
      <div class="flex items-end">
        <button onclick="filterPaymentReports()" class="w-full bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition">ุชุตููุฉ</button>
      </div>
    </div>

    <div class="overflow-x-auto mt-6">
      <table class="min-w-full divide-y divide-gray-200 text-sm text-right bg-white shadow rounded-lg" id="report-table">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-4 py-2">ุงุณู ุงูุทุงูุจุฉ</th>
            <th class="px-4 py-2">ุงูุตู</th>
            <th class="px-4 py-2">ุงูุดุนุจุฉ</th>
            <th class="px-4 py-2">ุขุฎุฑ ูุจูุบ ูุฏููุน</th>
            <th class="px-4 py-2">ุชุงุฑูุฎูุง</th>
            <th class="px-4 py-2">ุนุฏุฏ ุงูุฃูุงู ุจุฏูู ุฏูุน</th>
          </tr>
        </thead>
        <tbody id="report-table-body" class="divide-y divide-gray-100">
        </tbody>
      </table>
    </div>

    <div class="mt-4 text-left">
      <button onclick="printReportToWord()" class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 transition">
        ุทุจุงุนุฉ ุงูุชูุฑูุฑ ูู ููู Word
      </button>
    </div>
  </div>
</div>

</main>
        
        <footer class="bg-gray-800 text-white py-4 mt-8">
            <div class="container mx-auto px-4 text-center">
                <p>ูุธุงู ุฃูุณุงุท ูุฏุฑุณู - ุซุงูููุฉ ุงููุฌุฑ ุงูุฃูููุฉ  </p>
                <p>ุชุทููุฑ - Hamza Shakir</p>
            </div>
        </footer>
    </div>
    
    <!-- Modal for confirmations -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <h3 id="modal-title" class="text-xl font-bold mb-4"></h3>
            <p id="modal-message" class="mb-6"></p>
            <div class="flex justify-end space-x-2">
                <button id="modal-cancel" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-400 transition">ุฅูุบุงุก</button>
                <button id="modal-confirm" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition">ุชุฃููุฏ</button>
            </div>
        </div>
    </div>
    
    <script>
   let students = [];
let payments = [];
let currentStudentId = null;
let selectedStudentForPayment = null;
let db = null;

// ูุชุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช
let request = indexedDB.open("MyDatabase", 2);

request.onupgradeneeded = function (event) {
    db = event.target.result;

    if (!db.objectStoreNames.contains("students")) {
        db.createObjectStore("students", { keyPath: "id" });
    }

    if (!db.objectStoreNames.contains("payments")) {
        const paymentStore = db.createObjectStore("payments", { keyPath: "id", autoIncrement: true });
        paymentStore.createIndex("studentId", "studentId", { unique: false });
    }
};

request.onsuccess = function (event) {
    db = event.target.result;
    loadStudentsAndUpdateTable();
    // ููููู ุชุญููู payments ุจููุณ ุงูุทุฑููุฉ ุฅุฐุง ุงุญุชุฌุช
};

request.onerror = function (event) {
    console.error("Database error:", event.target.errorCode);
};


function addStudentToTable(student) {
    const tableBody = document.getElementById('students-table-body');
    const row = document.createElement('tr');

    const paidAmount = student.paidAmount || 0;
    const remainingAmount = student.totalAfterDiscount - paidAmount;

    row.innerHTML = `
        <td class="px-4 py-2">${student.name}</td>
        <td class="px-4 py-2">${student.grade}</td>
        <td class="px-4 py-2">${student.section}</td>
        <td class="px-4 py-2">${student.totalAmount.toLocaleString()} ุฏููุงุฑ</td>
        <td class="px-4 py-2">${student.discount.toLocaleString()} ุฏููุงุฑ</td>
        <td class="px-4 py-2">${student.totalAfterDiscount.toLocaleString()} ุฏููุงุฑ</td>
        <td class="px-4 py-2">${paidAmount.toLocaleString()} ุฏููุงุฑ</td>
        <td class="px-4 py-2">${remainingAmount.toLocaleString()} ุฏููุงุฑ</td>
        
<td class="px-4 py-2 space-x-1">
  <button onclick="editStudent('${student.id}')" class="bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600 text-sm">ุชุนุฏูู</button>
  <button onclick="confirmDeleteStudent('${student.id}')" class="bg-red-600 text-white px-2 py-1 rounded hover:bg-red-700 text-sm">ุญุฐู</button>
</td>

    `;
    tableBody.appendChild(row);
}


// ุชุญููู ุงูุทูุงุจ ูุชุญุฏูุซ ุงูุฌุฏูู
function loadStudentsAndUpdateTable() {
    const transaction = db.transaction("students", "readonly");
    const store = transaction.objectStore("students");
    const getAllRequest = store.getAll();

    getAllRequest.onsuccess = function () {
        students = getAllRequest.result || [];
        updateStudentsTable();
    };
}

// Set today's date as default for payment date
document.getElementById('payment-date').valueAsDate = new Date();

// Tab navigation
document.querySelectorAll('.tab-btn').forEach(button => {
    button.addEventListener('click', () => {
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });

        const tabId = button.getAttribute('data-tab');
        document.getElementById(tabId).classList.add('active');
        button.classList.add('active');

        if (tabId === 'statistics') {
            updateStatistics();
        }
    });
});

// ูุนุงูุฌุฉ ุฅุฑุณุงู ูููุฐุฌ ุงูุทุงูุจ
document.getElementById('student-form').addEventListener('submit', function (e) {
    e.preventDefault();

    const name = document.getElementById('student-name').value;
    const email = document.getElementById('student-email').value;
    const grade = document.getElementById('student-grade').value;
    const section = document.getElementById('student-section').value;
    const totalAmount = parseFloat(document.getElementById('student-total-amount').value);
    const discount = parseFloat(document.getElementById('student-discount').value) || 0;
    const notes = document.getElementById('student-notes').value;

    const totalAfterDiscount = totalAmount - discount;

    const transaction = db.transaction("students", "readwrite");
    const store = transaction.objectStore("students");

    if (currentStudentId !== null) {
        // ุชุนุฏูู ุทุงูุจ
        const existing = students.find(s => s.id === currentStudentId);
        if (existing) {
            const updatedStudent = {
                ...existing,
                name, email, grade, section,
                totalAmount, discount,
                totalAfterDiscount, notes
            };
            store.put(updatedStudent);
            showAlert("ุชู ุชุนุฏูู ุจูุงูุงุช ุงูุทุงูุจุฉ ุจูุฌุงุญ");
        }
    } else {
        // ุฅุถุงูุฉ ุทุงูุจ ุฌุฏูุฏ
        const newStudent = {
            id: Date.now().toString(),
            name,
            email,
            grade,
            section,
            totalAmount,
            discount,
            totalAfterDiscount,
            notes,
            paidAmount: 0
        };
        store.add(newStudent);
students.push(newStudent);
addStudentToTable(newStudent);
        showAlert("ุชูุช ุฅุถุงูุฉ ุงูุทุงูุจุฉ ุจูุฌุงุญ");
    }
    

    transaction.oncomplete = function () {
        resetStudentForm();
        loadStudentsAndUpdateTable();
    };

    transaction.onerror = function (event) {
        console.error("ุฎุทุฃ ูู ุชุฎุฒูู ุงูุจูุงูุงุช:", event.target.error);
    };
});

function resetStudentForm() {
    document.getElementById('student-form').reset();
    currentStudentId = null;
   
}


let currentPage = 1;
const studentsPerPage = 50;
function updateStudentsTable() {
    const tableBody = document.getElementById('students-table-body');
    tableBody.innerHTML = '';

    // ุชุฑุชูุจ ุญุณุจ ุงูุตู ุซู ุงูุงุณู
    const sortedStudents = [...students].sort((a, b) => {
        const gradeComp = a.grade.localeCompare(b.grade, 'ar');
        return gradeComp !== 0 ? gradeComp : a.name.localeCompare(b.name, 'ar');
    });

    const startIndex = (currentPage - 1) * studentsPerPage;
    const paginatedStudents = sortedStudents.slice(startIndex, startIndex + studentsPerPage);

    paginatedStudents.forEach((student, i) => {
        const paidAmount = student.paidAmount || 0;
        const remainingAmount = student.totalAfterDiscount - paidAmount;

        const row = document.createElement('tr');
        row.innerHTML = `
            <td class="px-4 py-2">${student.name}</td>
            <td class="px-4 py-2">${student.grade}</td>
            <td class="px-4 py-2">${student.section}</td>
            <td class="px-4 py-2">${student.totalAmount.toLocaleString()} ุฏููุงุฑ</td>
            <td class="px-4 py-2">${student.discount.toLocaleString()} ุฏููุงุฑ</td>
            <td class="px-4 py-2">${student.totalAfterDiscount.toLocaleString()} ุฏููุงุฑ</td>
            <td class="px-4 py-2">${paidAmount.toLocaleString()} ุฏููุงุฑ</td>
            <td class="px-4 py-2">${remainingAmount.toLocaleString()} ุฏููุงุฑ</td>
            <td class="px-4 py-2 space-x-1">
                <button onclick="editStudent('${student.id}')" class="bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600 text-sm">ุชุนุฏูู</button>
                <button onclick="confirmDeleteStudent('${student.id}')" class="bg-red-600 text-white px-2 py-1 rounded hover:bg-red-700 text-sm">ุญุฐู</button>
            </td>
        `;
        tableBody.appendChild(row);
    });

    renderPaginationControls();
}

function renderPaginationControls() {
    const totalPages = Math.ceil(students.length / studentsPerPage);
    const container = document.getElementById('pagination-controls');
    container.innerHTML = '';

    if (totalPages <= 1) return;

    const prevBtn = document.createElement('button');
    prevBtn.textContent = 'โฌ ุงูุณุงุจู';
    prevBtn.className = 'px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600';
    prevBtn.disabled = currentPage === 1;
    prevBtn.onclick = () => {
        currentPage--;
        updateStudentsTable();
    };

    const nextBtn = document.createElement('button');
    nextBtn.textContent = 'ุงูุชุงูู โก';
    nextBtn.className = 'px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600';
    nextBtn.disabled = currentPage === totalPages;
    nextBtn.onclick = () => {
        currentPage++;
        updateStudentsTable();
    };

    container.appendChild(prevBtn);
    const pageLabel = document.createElement('span');
    pageLabel.textContent = ` ุงูุตูุญุฉ ${currentPage} ูู ${totalPages} `;
    pageLabel.className = 'px-2 text-gray-700 font-bold';
    container.appendChild(pageLabel);
    container.appendChild(nextBtn);
}
        
      function editStudent(studentId) {
    const student = students.find(s => s.id == studentId);
    if (student) {
        document.getElementById('student-name').value = student.name;
        document.getElementById('student-email').value = student.email;
        document.getElementById('student-grade').value = student.grade;
        document.getElementById('student-section').value = student.section;
        document.getElementById('student-total-amount').value = student.totalAmount;
        document.getElementById('student-discount').value = student.discount;
        document.getElementById('student-notes').value = student.notes || '';

        currentStudentId = studentId;
        document.getElementById('edit-student-btn').disabled = false;
        document.getElementById('delete-student-btn').disabled = false;

        document.getElementById('student-form').scrollIntoView({ behavior: 'smooth' });
    }
}

       
// Search for students
document.getElementById('search-btn').addEventListener('click', function() {
    const searchName = document.getElementById('search-name').value.toLowerCase();
    const searchGrade = document.getElementById('search-grade').value;
    const searchSection = document.getElementById('search-section').value;
    
    let request = indexedDB.open("MyDatabase", 2);
    
    request.onsuccess = function(event) {
        const db = event.target.result;
        const studentTransaction = db.transaction("students", "readonly");
        const studentStore = studentTransaction.objectStore("students");
        
        // Retrieve all students
        let studentRequest = studentStore.getAll();

        studentRequest.onsuccess = function() {
            const students = studentRequest.result;
            
            // Filter students based on search criteria
            const filteredStudents = students.filter(student => {
                return (
                    (searchName === '' || student.name.includes(searchName)) &&
                    (searchGrade === '' || student.grade === searchGrade) &&
                    (searchSection === '' || student.section === searchSection)
                );
            });
            
            const resultsBody = document.getElementById('search-results-body');
            resultsBody.innerHTML = '';
            
            if (filteredStudents.length === 0) {
                document.getElementById('search-results').classList.remove('hidden');
                resultsBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-4 py-4 text-center">ูุง ุชูุฌุฏ ูุชุงุฆุฌ ูุทุงุจูุฉ ููุจุญุซ</td>
                    </tr>
                `;
                return;
            }
            
            filteredStudents.forEach(student => {
                const paidAmount = student.paidAmount || 0;
                const remainingAmount = student.totalAfterDiscount - paidAmount;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-2">${student.name}</td>
                    <td class="px-4 py-2">${student.grade}</td>
                    <td class="px-4 py-2">${student.section}</td>
                    <td class="px-4 py-2">${student.totalAfterDiscount.toLocaleString()} ุฏููุงุฑ</td>
                    <td class="px-4 py-2">${paidAmount.toLocaleString()} ุฏููุงุฑ</td>
                    <td class="px-4 py-2">${remainingAmount.toLocaleString()} ุฏููุงุฑ</td>
                    <td class="px-4 py-2">
                        <button class="pay-btn bg-green-500 text-white px-3 py-1 rounded-md hover:bg-green-600 transition text-sm" data-id="${student.id}">ุชุณุฏูุฏ ูุณุท</button>
                    </td>
                `;
                
                resultsBody.appendChild(row);
            });
            
            document.getElementById('search-results').classList.remove('hidden');
            
            // Add event listeners to pay buttons
            document.querySelectorAll('.pay-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const studentId = button.getAttribute('data-id');
                    selectStudentForPayment(studentId);
                });
            });
        };
        
        studentRequest.onerror = function() {
            console.error("Error retrieving students from IndexedDB.");
        };
    };
    
    request.onerror = function(event) {
        console.error("Database error:", event.target.errorCode);
    };
});
// Select student for payment
function selectStudentForPayment(studentId) {
    let request = indexedDB.open("MyDatabase", 2);

    request.onsuccess = function(event) {
        const db = event.target.result;
        const studentTransaction = db.transaction("students", "readonly");
        const studentStore = studentTransaction.objectStore("students");

        // Retrieve the specific student
        let studentRequest = studentStore.get((studentId));

        studentRequest.onsuccess = function() {
            const student = studentRequest.result;
            if (student) {
                selectedStudentForPayment = student;
                
                // Update payment form with student info
                document.getElementById('payment-student-name').textContent = student.name;
                document.getElementById('payment-student-grade').textContent = student.grade;
                document.getElementById('payment-student-section').textContent = student.section;
                document.getElementById('payment-total-amount').textContent = student.totalAmount.toLocaleString();
                document.getElementById('payment-student-discount').textContent = student.discount.toLocaleString();
                document.getElementById('payment-total-after-discount').textContent = student.totalAfterDiscount.toLocaleString();
                document.getElementById('payment-paid-amount').textContent = (student.paidAmount || 0).toLocaleString();
                document.getElementById('payment-remaining-amount').textContent = (student.totalAfterDiscount - (student.paidAmount || 0)).toLocaleString();
                
                // Show payment form
                document.getElementById('payment-form').classList.remove('hidden');
                
                // Update payment history
                updatePaymentHistory(studentId);
                
                // Scroll to payment form
                document.getElementById('payment-form').scrollIntoView({ behavior: 'smooth' });
            }
        };

        studentRequest.onerror = function() {
            console.error("Error retrieving student for payment.");
        };
    };
    
    request.onerror = function(event) {
        console.error("Database error:", event.target.errorCode);
    };
}
// Update payment history
function updatePaymentHistory(studentId) {
    const historyBody = document.getElementById('payment-history');
    historyBody.innerHTML = '';

    let request = indexedDB.open("MyDatabase", 2);

    request.onsuccess = function(event) {
        const db = event.target.result;
        const paymentTransaction = db.transaction("payments", "readonly");
        const paymentStore = paymentTransaction.objectStore("payments");

        // Retrieve all payments for the student
        let paymentRequest = paymentStore.index("studentId").getAll((studentId));

        paymentRequest.onsuccess = function() {
            const studentPayments = paymentRequest.result;

            if (studentPayments.length === 0) {
                historyBody.innerHTML = `
                    <tr>
                        <td colspan="3" class="px-4 py-4 text-center">ูุง ุชูุฌุฏ ุฏูุนุงุช ุณุงุจูุฉ</td>
                    </tr>
                `;
                return;
            }
studentPayments.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(payment => {
  const row = document.createElement('tr');
  row.innerHTML = `
    <td class="px-4 py-2">${formatDate(payment.date)}</td>
    <td class="px-4 py-2">${payment.amount.toLocaleString()} ุฏููุงุฑ</td>
    <td class="px-4 py-2">${payment.installmentNumber || ""}</td>
    <td class="px-4 py-2">${payment.receiptNumber}</td>
    <td class="px-4 py-2">
      <button class="bg-blue-600 text-white px-2 py-1 rounded text-sm hover:bg-blue-700"
        onclick='printSpecificReceipt(${JSON.stringify(payment)})'>ุทุจุงุนุฉ</button>
    </td>
  `;
  historyBody.appendChild(row);
});

        };

        paymentRequest.onerror = function() {
            console.error("Error retrieving payments from IndexedDB.");
        };
    };
    
    request.onerror = function(event) {
        console.error("Database error:", event.target.errorCode);
    };
}

      document.getElementById('add-payment-btn').addEventListener('click', function() {
    if (!selectedStudentForPayment) return;

    const amount = parseFloat(document.getElementById('payment-amount').value);
    const receiptNumber = document.getElementById('payment-receipt-number').value;
    const date = document.getElementById('payment-date').value;

    if (!amount || !receiptNumber || !date) {
        showAlert('ูุฑุฌู ููุก ุฌููุน ุงูุญููู ุงููุทููุจุฉ', 'error');
        return;
    }

    
    const installmentNumber = document.getElementById('payment-installment-number').value;
    if (!installmentNumber) {
        showAlert('ูุฑุฌู ุงุฎุชูุงุฑ ุฑูู ุงูุฏูุนุฉ', 'error');
        return;
    }

    const remainingAmount = selectedStudentForPayment.totalAfterDiscount - (selectedStudentForPayment.paidAmount || 0);

    if (amount > remainingAmount) {
        showAlert('ุงููุจูุบ ุงููุฏุฎู ุฃูุจุฑ ูู ุงููุจูุบ ุงููุชุจูู', 'error');
        return;
    }

    // Add payment
    const newPayment = {
        installmentNumber,
        id: Date.now().toString(),
        studentId: selectedStudentForPayment.id,
        amount,
        receiptNumber,
        date
    };

    savePayment(newPayment); // ุญูุธ ุงูุฏูุน ูู IndexedDB
    function savePayment(payment) {
    const transaction = db.transaction("payments", "readwrite");
    const store = transaction.objectStore("payments");
    store.add(payment);
}
    // Update student paid amount
    const studentIndex = students.findIndex(s => s.id === selectedStudentForPayment.id);
    if (studentIndex !== -1) {
        students[studentIndex].paidAmount = (students[studentIndex].paidAmount || 0) + amount;
        selectedStudentForPayment = students[studentIndex];
    }

    // Save updated student data
    saveStudent(selectedStudentForPayment); // ุญูุธ ุงูุทุงูุจ ูู IndexedDB
function saveStudent(student) {
    const transaction = db.transaction("students", "readwrite");
    const store = transaction.objectStore("students");
    store.put(student);
}
    // Update payment form display
    document.getElementById('payment-paid-amount').textContent = selectedStudentForPayment.paidAmount.toLocaleString();
    document.getElementById('payment-remaining-amount').textContent = (selectedStudentForPayment.totalAfterDiscount - selectedStudentForPayment.paidAmount).toLocaleString();

    // Update payment history
    updatePaymentHistory(selectedStudentForPayment.id);

    // Reset payment form
    document.getElementById('payment-amount').value = '';
    document.getElementById('payment-receipt-number').value = '';

    // Show success alert
    showAlert('ุชู ุฅุถุงูุฉ ุงูุฏูุนุฉ ุจูุฌุงุญ');
    updateReceiptPreview(newPayment)
});
function updateReceiptPreview(payment) {
  if (!selectedStudentForPayment || !payment) return;

  const student = selectedStudentForPayment;
  const name = student.name;
  const grade = student.grade;
  const section = student.section;
  const discount = student.discount.toLocaleString();
  const receiptNumber = payment.receiptNumber;
  const date = formatDate(payment.date);
  const amount = payment.amount.toLocaleString();
  const total = student.totalAmount.toLocaleString();
  const totalAfterDiscount = student.totalAfterDiscount.toLocaleString();
  const paid = student.paidAmount.toLocaleString();
  const remaining = (student.totalAfterDiscount - student.paidAmount).toLocaleString();

  // ุงููุตู ุงูุฃูู
  document.getElementById('receipt-student-name').textContent = name;
  document.getElementById('receipt-student-grade').textContent = grade;
  document.getElementById('receipt-student-section').textContent = section;
  document.getElementById('receipt-student-discount').textContent = discount;
  document.getElementById('receipt-number').textContent = receiptNumber;
  document.getElementById('receipt-date').textContent = date;
  document.getElementById('receipt-amount').textContent = amount;
  document.getElementById('receipt-total').textContent = total;
  document.getElementById('receipt-total-after-discount').textContent = totalAfterDiscount;
  document.getElementById('receipt-total-paid').textContent = paid;
  document.getElementById('receipt-remaining').textContent = remaining;

  // ุงููุตู ุงูุซุงูู (ูุณุฎุฉ)
  document.getElementById('receipt-student-name-copy').textContent = name;
  document.getElementById('receipt-student-grade-copy').textContent = grade;
  document.getElementById('receipt-student-section-copy').textContent = section;
  document.getElementById('receipt-student-discount-copy').textContent = discount;
  document.getElementById('receipt-number-copy').textContent = receiptNumber;
  document.getElementById('receipt-date-copy').textContent = date;
  
  const installment = payment.installmentNumber || "";
  document.getElementById('receipt-installment').textContent = installment;
  document.getElementById('receipt-installment-copy').textContent = installment;

  document.getElementById('receipt-amount-copy').textContent = amount;
  document.getElementById('receipt-total-copy').textContent = total;
  document.getElementById('receipt-total-after-discount-copy').textContent = totalAfterDiscount;
  document.getElementById('receipt-total-paid-copy').textContent = paid;
  document.getElementById('receipt-remaining-copy').textContent = remaining;
}


// Email receipt
document.getElementById('email-receipt-btn').addEventListener('click', function() {
    if (!selectedStudentForPayment) return;
    
    if (!selectedStudentForPayment.email) {
        showAlert('ูุง ููุฌุฏ ุจุฑูุฏ ุฅููุชุฑููู ูุณุฌู ููุทุงูุจุฉ', 'error');
        return;
    }
    
    // In a real application, this would send an email
    // For this demo, we'll just show a success message
    showAlert(`ุชู ุฅุฑุณุงู ุงููุตู ุฅูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู: ${selectedStudentForPayment.email}`);
});
let collectionChart, gradesChart, sectionsChart;

function updateStatistics() {
    const gradeFilter = document.getElementById('filter-grade').value;
    const sectionFilter = document.getElementById('filter-section').value;

    const dbRequest = indexedDB.open('MyDatabase', 2);

    dbRequest.onsuccess = function(event) {
        const db = event.target.result;
        const transaction = db.transaction(['students'], 'readonly');
        const store = transaction.objectStore('students');
        const studentsRequest = store.getAll();

        studentsRequest.onsuccess = function() {
            let students = studentsRequest.result;

            if (gradeFilter) students = students.filter(s => s.grade === gradeFilter);
            if (sectionFilter) students = students.filter(s => s.section === sectionFilter);

            const totalStudents = students.length;
            const totalFees = students.reduce((sum, student) => sum + student.totalAfterDiscount, 0);
            const totalPaid = students.reduce((sum, student) => sum + (student.paidAmount || 0), 0);
            const totalRemaining = totalFees - totalPaid;

            document.getElementById('total-students').textContent = totalStudents;
            document.getElementById('total-fees').textContent = totalFees.toLocaleString() + ' ุฏููุงุฑ';
            document.getElementById('total-paid').textContent = totalPaid.toLocaleString() + ' ุฏููุงุฑ';
            document.getElementById('total-remaining').textContent = totalRemaining.toLocaleString() + ' ุฏููุงุฑ';

            // ุชุญุฏูุซ ูุฎุทุท ูุณุจุฉ ุงูุชุญุตูู
            if (collectionChart) collectionChart.destroy();
            const collectionCtx = document.getElementById('collection-chart').getContext('2d');
            collectionChart = new Chart(collectionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['ุงููุฏููุน', 'ุงููุชุจูู'],
                    datasets: [{
                        data: [totalPaid, totalRemaining],
                        backgroundColor: ['#10B981', '#F59E0B']
                    }]
                },
                options: { plugins: { legend: { position: 'bottom' } } }
            });

            // ุชุญุฏูุซ ุชูุฒูุน ุงูุตููู
            const gradesCounts = {};
            students.forEach(student => {
                gradesCounts[student.grade] = (gradesCounts[student.grade] || 0) + 1;
            });

            if (gradesChart) gradesChart.destroy();
            const gradesCtx = document.getElementById('grades-chart').getContext('2d');
            gradesChart = new Chart(gradesCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(gradesCounts),
                    datasets: [{
                        data: Object.values(gradesCounts),
                        backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#EC4899', '#14B8A6', '#F97316', '#6366F1', '#84CC16', '#A855F7']
                    }]
                },
                options: { plugins: { legend: { position: 'bottom' } } }
            });

            // ุชุญุฏูุซ ุชูุฒูุน ุงูุดุนุจ
            const sectionsCounts = {};
            students.forEach(student => {
                sectionsCounts[student.section] = (sectionsCounts[student.section] || 0) + 1;
            });

            if (sectionsChart) sectionsChart.destroy();
            const sectionsCtx = document.getElementById('sections-chart').getContext('2d');
            sectionsChart = new Chart(sectionsCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(sectionsCounts),
                    datasets: [{
                        label: 'ุนุฏุฏ ุงูุทุงูุจุงุช',
                        data: Object.values(sectionsCounts),
                        backgroundColor: '#3B82F6'
                    }]
                },
                options: {
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, ticks: { precision: 0 } } }
                }
            });
        };
    };
}
// Backup data
document.getElementById('backup-btn').addEventListener('click', function() {
    const dbRequest = indexedDB.open('MyDatabase', 2);

    dbRequest.onsuccess = function(event) {
        const db = event.target.result;
        const transaction = db.transaction(['students', 'payments'], 'readonly');
        const studentsStore = transaction.objectStore('students');
        const paymentsStore = transaction.objectStore('payments');
        
        const studentsRequest = studentsStore.getAll(); // Get all students
        const paymentsRequest = paymentsStore.getAll(); // Get all payments
        
        studentsRequest.onsuccess = function() {
            paymentsRequest.onsuccess = function() {
                const backupData = {
                    students: studentsRequest.result,
                    payments: paymentsRequest.result,
                    timestamp: new Date().toISOString()
                };

                const dataStr = JSON.stringify(backupData);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                
                const exportFileName = `school_fees_backup_${formatDateForFile(new Date())}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileName);
                linkElement.click();
                
                showAlert('ุชู ุฅูุดุงุก ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุจูุฌุงุญ');
            };
        };

        studentsRequest.onerror = function() {
            showAlert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฌูุจ ุจูุงูุงุช ุงูุทุงูุจุงุช', 'error');
        };
    };

    dbRequest.onerror = function() {
        showAlert('ูุดู ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช', 'error');
    };
});

// Handle restore file selection
document.getElementById('restore-file').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        document.getElementById('selected-file-name').textContent = file.name;
        document.getElementById('restore-btn').disabled = false;
    } else {
        document.getElementById('selected-file-name').textContent = 'ูู ูุชู ุงุฎุชูุงุฑ ููู';
        document.getElementById('restore-btn').disabled = true;
    }
});

// Restore backup
document.getElementById('restore-btn').addEventListener('click', function() {
    const fileInput = document.getElementById('restore-file');
    const file = fileInput.files[0];
    
    if (!file) {
        showAlert('ูุฑุฌู ุงุฎุชูุงุฑ ููู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุฃููุงู', 'error');
        return;
    }

    showConfirmModal(
        'ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ',
        'ุณูุชู ุงุณุชุจุฏุงู ุฌููุน ุงูุจูุงูุงุช ุงูุญุงููุฉ ุจุงูุจูุงูุงุช ูู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ. ูู ุฃูุช ูุชุฃูุฏ ูู ุงููุชุงุจุนุฉุ',
        () => {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    if (!backupData.students || !backupData.payments) {
                        throw new Error('ุชูุณูู ููู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุบูุฑ ุตุญูุญ');
                    }

                    // Open IndexedDB for writing
                    const dbRequest = indexedDB.open('MyDatabase', 2);
                    dbRequest.onsuccess = function(event) {
                        const db = event.target.result;
                        const transaction = db.transaction(['students', 'payments'], 'readwrite');
                        const studentsStore = transaction.objectStore('students');
                        const paymentsStore = transaction.objectStore('payments');
                        
                        // Clear current data
                        studentsStore.clear();
                        paymentsStore.clear();

                        // Insert new data from backup
                        backupData.students.forEach(student => studentsStore.add(student));
                        backupData.payments.forEach(payment => paymentsStore.add(payment));

                        // Commit changes and show alert
                        transaction.oncomplete = function() {
                            showAlert('ุชูุช ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุจูุฌุงุญ');
                              // โ ุชุญุฏูุซ ุงููุงุฌูุฉ ุจุฏูู ุฅุนุงุฏุฉ ุชุญููู:
                             loadStudentsAndUpdateTable();
                              updateStatistics();
                            // Reset file input
                            fileInput.value = '';
                            document.getElementById('selected-file-name').textContent = 'ูู ูุชู ุงุฎุชูุงุฑ ููู';
                            document.getElementById('restore-btn').disabled = true;
                        };

                        transaction.onerror = function() {
                            showAlert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ', 'error');
                        };
                    };

                    dbRequest.onerror = function() {
                        showAlert('ูุดู ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช', 'error');
                    };
                } catch (error) {
                    showAlert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        }
    );
});

// Export students to Excel
document.getElementById('export-students-btn').addEventListener('click', function() {
    const dbRequest = indexedDB.open('MyDatabase', 2);

    dbRequest.onsuccess = function(event) {
        const db = event.target.result;
        const transaction = db.transaction(['students'], 'readonly');
        const studentsStore = transaction.objectStore('students');
        
        const studentsRequest = studentsStore.getAll(); // Get all students
        
        studentsRequest.onsuccess = function() {
            if (studentsRequest.result.length === 0) {
                showAlert('ูุง ุชูุฌุฏ ุจูุงูุงุช ููุชุตุฏูุฑ', 'error');
                return;
            }

            const studentsData = studentsRequest.result.map(student => {
                const paidAmount = student.paidAmount || 0;
                const remainingAmount = student.totalAfterDiscount - paidAmount;
                
                return {
                    'ุงุณู ุงูุทุงูุจุฉ': student.name,
                    'ุงูุจุฑูุฏ ุงูุฅููุชุฑููู': student.email || '',
                    'ุงูุตู': student.grade,
                    'ุงูุดุนุจุฉ': student.section,
                    'ุงููุจูุบ ุงูููู': student.totalAmount,
                    'ุงูุฎุตู ': student.discount,
                    'ุงููุจูุบ ุจุนุฏ ุงูุฎุตู': student.totalAfterDiscount,
                    'ุงููุจูุบ ุงููุฏููุน': paidAmount,
                    'ุงููุจูุบ ุงููุชุจูู': remainingAmount,
                    'ููุงุญุธุงุช': student.notes || ''
                };
            });
            
            exportToExcel(studentsData, 'students_data');
            showAlert('ุชู ุชุตุฏูุฑ ุจูุงูุงุช ุงูุทุงูุจุงุช ุจูุฌุงุญ');
        };

        studentsRequest.onerror = function() {
            showAlert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฌูุจ ุจูุงูุงุช ุงูุทุงูุจุงุช ูู IndexedDB', 'error');
        };
    };

    dbRequest.onerror = function() {
        showAlert('ูุดู ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช', 'error');
    };
});
// Export payments to Excel
document.getElementById('export-payments-btn').addEventListener('click', function() {
    const dbRequest = indexedDB.open('MyDatabase', 2);

    dbRequest.onsuccess = function(event) {
        const db = event.target.result;
        const transaction = db.transaction(['students', 'payments'], 'readonly');
        const studentsStore = transaction.objectStore('students');
        const paymentsStore = transaction.objectStore('payments');
        
        const studentsRequest = studentsStore.getAll(); // Get all students
        const paymentsRequest = paymentsStore.getAll(); // Get all payments
        
        studentsRequest.onsuccess = function() {
            paymentsRequest.onsuccess = function() {
                const paymentsData = paymentsRequest.result.map(payment => {
                    const student = studentsRequest.result.find(s => s.id === payment.studentId) || {};
                    
                    return {
                        'ุงุณู ุงูุทุงูุจุฉ': student.name || 'ุบูุฑ ูุนุฑูู',
                        'ุงูุตู': student.grade || '',
                        'ุงูุดุนุจุฉ': student.section || '',
                        'ุงููุจูุบ': payment.amount,
                        'ุฑูู ุงููุตู': payment.receiptNumber,
                        'ุชุงุฑูุฎ ุงูุฏูุน': formatDate(payment.date)
                    };
                });
                
                exportToExcel(paymentsData, 'payments_data');
                showAlert('ุชู ุชุตุฏูุฑ ุจูุงูุงุช ุงูุฏูุนุงุช ุจูุฌุงุญ');
            };
        };

        studentsRequest.onerror = function() {
            showAlert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฌูุจ ุจูุงูุงุช ุงูุทุงูุจุงุช', 'error');
        };

        paymentsRequest.onerror = function() {
            showAlert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฌูุจ ุจูุงูุงุช ุงูุฏูุนุงุช', 'error');
        };
    };

    dbRequest.onerror = function() {
        showAlert('ูุดู ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช', 'error');
    };
});

// Export all data to Excel
document.getElementById('export-all-btn').addEventListener('click', function() {
    const dbRequest = indexedDB.open('MyDatabase', 2);

    dbRequest.onsuccess = function(event) {
        const db = event.target.result;
        const transaction = db.transaction(['students', 'payments'], 'readonly');
        const studentsStore = transaction.objectStore('students');
        const paymentsStore = transaction.objectStore('payments');
        
        const studentsRequest = studentsStore.getAll(); // Get all students
        const paymentsRequest = paymentsStore.getAll(); // Get all payments
        
        studentsRequest.onsuccess = function() {
            paymentsRequest.onsuccess = function() {
                const wb = XLSX.utils.book_new();
                
                // Students sheet
                if (studentsRequest.result.length > 0) {
                    const studentsData = studentsRequest.result.map(student => {
                        const paidAmount = student.paidAmount || 0;
                        const remainingAmount = student.totalAfterDiscount - paidAmount;
                        
                        return {
                            
                            'ุงุณู ุงูุทุงูุจุฉ': student.name,
                            'ุงูุจุฑูุฏ ุงูุฅููุชุฑููู': student.email || '',
                            'ุงูุตู': student.grade,
                            'ุงูุดุนุจุฉ': student.section,
                            'ุงููุจูุบ ุงูููู': student.totalAmount,
                            'ุงูุฎุตู ': student.discount,
                            'ุงููุจูุบ ุจุนุฏ ุงูุฎุตู': student.totalAfterDiscount,
                            'ุงููุจูุบ ุงููุฏููุน': paidAmount,
                            'ุงููุจูุบ ุงููุชุจูู': remainingAmount,
                            'ููุงุญุธุงุช': student.notes || ''
                        };
                    });
                    
                    const ws = XLSX.utils.json_to_sheet(studentsData);
                    XLSX.utils.book_append_sheet(wb, ws, 'ุงูุทุงูุจุงุช');
                }
                
                // Payments sheet
                if (paymentsRequest.result.length > 0) {
                    const paymentsData = paymentsRequest.result.map(payment => {
                        const student = studentsRequest.result.find(s => s.id === payment.studentId) || {};
                        const remainingAmount = student.totalAfterDiscount - payment.amount;
                        
                        return {
                            
                            'ุงุณู ุงูุทุงูุจุฉ': student.name || 'ุบูุฑ ูุนุฑูู',
                            'ุงูุตู': student.grade || '',
                            'ุงูุดุนุจุฉ': student.section || '',
                            'ุงููุจูุบ ุจุนุฏ ุงูุฎุตู': student.totalAfterDiscount,
                            'ุงููุจูุบ': payment.amount,
                            'ุฑูู ุงููุตู': payment.receiptNumber,
                            'ุงููุจูุบ ุงููุชุจูู': remainingAmount,
                            'ุชุงุฑูุฎ ุงูุฏูุน': formatDate(payment.date)
                        };
                    });
                    
                    const ws = XLSX.utils.json_to_sheet(paymentsData);
                    XLSX.utils.book_append_sheet(wb, ws, 'ุงูุฏูุนุงุช');
                }
                
                // Export the workbook
                XLSX.writeFile(wb, `school_fees_data_${formatDateForFile(new Date())}.xlsx`);
                showAlert('ุชู ุชุตุฏูุฑ ุฌููุน ุงูุจูุงูุงุช ุจูุฌุงุญ');
            };
        };

        studentsRequest.onerror = function() {
            showAlert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฌูุจ ุจูุงูุงุช ุงูุทุงูุจุงุช', 'error');
        };

        paymentsRequest.onerror = function() {
            showAlert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฌูุจ ุจูุงูุงุช ุงูุฏูุนุงุช', 'error');
        };
    };

    dbRequest.onerror = function() {
        showAlert('ูุดู ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช', 'error');
    };
});

// Clear all data
document.getElementById('clear-data-btn').addEventListener('click', function() {
    showConfirmModal(
        'ูุณุญ ุฌููุน ุงูุจูุงูุงุช',
        'ุณูุชู ุญุฐู ุฌููุน ุงูุจูุงูุงุช ูู ุงููุธุงู ุจุดูู ููุงุฆู. ูู ุฃูุช ูุชุฃูุฏ ูู ุงููุชุงุจุนุฉุ',
        () => {
            const dbRequest = indexedDB.open('MyDatabase', 2);
            
            dbRequest.onsuccess = function(event) {
                const db = event.target.result;
                const transaction = db.transaction(['students', 'payments'], 'readwrite');
                const studentsStore = transaction.objectStore('students');
                const paymentsStore = transaction.objectStore('payments');
                
                studentsStore.clear();
                paymentsStore.clear();

                transaction.oncomplete = function() {
                    // ุชูุฑูุบ ุงููุชุบูุฑุงุช ูุชุญุฏูุซ ุงูุฌุฏูู
                    students = [];
                    payments = [];
                    updateStudentsTable();
                    showAlert('ุชู ูุณุญ ุฌููุน ุงูุจูุงูุงุช ุจูุฌุงุญ');
                };

                transaction.onerror = function() {
                    showAlert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ูุณุญ ุงูุจูุงูุงุช', 'error');
                };
            };

            dbRequest.onerror = function() {
                showAlert('ูุดู ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช', 'error');
            };
        }
    );
});
// Helper function to format date
function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('ar-IQ');
}

// Helper function to format date for filenames
function formatDateForFile(date) {
    return date.toISOString().split('T')[0];
}

// Helper function to export data to Excel
function exportToExcel(data, fileName) {
    const ws = XLSX.utils.json_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Data');
    XLSX.writeFile(wb, `${fileName}_${formatDateForFile(new Date())}.xlsx`);
}

// Show alert message
function showAlert(message, type = 'success') {
    const alertDiv = document.createElement('div');
    alertDiv.className = `fixed top-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-md shadow-lg z-50 ${
        type === 'success' ? 'bg-green-500' : 'bg-red-500'
    } text-white`;
    alertDiv.textContent = message;

    document.body.appendChild(alertDiv);

    setTimeout(() => {
        alertDiv.classList.add('opacity-0', 'transition-opacity', 'duration-500');
        setTimeout(() => {
            document.body.removeChild(alertDiv);
        }, 500);
    }, 3000);
}

// Show confirmation modal
function showConfirmModal(title, message, confirmCallback) {
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modal-title');
    const modalMessage = document.getElementById('modal-message');
    const modalConfirm = document.getElementById('modal-confirm');
    const modalCancel = document.getElementById('modal-cancel');

    modalTitle.textContent = title;
    modalMessage.textContent = message;

    modal.classList.remove('hidden');

    modalConfirm.onclick = () => {
        confirmCallback();
        modal.classList.add('hidden');
    };

    modalCancel.onclick = () => {
        modal.classList.add('hidden');
    };
}
// Initialize the app
updateStudentsTable();


</script>

<script>(function() {
  function c() {
    var b = a.contentDocument || a.contentWindow.document;
    if (b) {
      var d = b.createElement('script');
      d.innerHTML = "window.__CF$cv$params={r:'93d44797a53fac2f',t:'MTc0NjgyNjAzNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
      b.getElementsByTagName('head')[0].appendChild(d);
    }
  }
  if (document.body) {
    var a = document.createElement('iframe');
    a.height = 1;
    a.width = 1;
    a.style.position = 'absolute';
    a.style.top = 0;
    a.style.left = 0;
    a.style.border = 'none';
    a.style.visibility = 'hidden';
    document.body.appendChild(a);
    if ('loading' !== document.readyState) c();
    else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c);
    else {
      var e = document.onreadystatechange || function() {};
      document.onreadystatechange = function(b) {
        e(b);
        'loading' !== document.readyState && (document.onreadystatechange = e, c())
      }
    }
  }
})();


</script>

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js');
  }

  let deferredPrompt;
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
  });


</script>
<script>
// ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูููุตู
const receiptDBName = 'MyDatabase';
const receiptStoreName = 'receiptNumbers';

function openReceiptDB(callback) {
  const dbRequest = indexedDB.open(receiptDBName, 2);

  dbRequest.onupgradeneeded = function (event) {
    const db = event.target.result;
    if (!db.objectStoreNames.contains(receiptStoreName)) {
      db.createObjectStore(receiptStoreName, { keyPath: 'id' });
    }
  };

  dbRequest.onsuccess = function (event) {
    callback(event.target.result);
  };

  dbRequest.onerror = function (event) {
    console.error("Database error:", event.target.errorCode);
  };
}

function getLastReceiptNumber(callback) {
  openReceiptDB(function (db) {
    const tx = db.transaction(receiptStoreName, 'readonly');
    const store = tx.objectStore(receiptStoreName);
    const req = store.get(1);

    req.onsuccess = function () {
      const result = req.result;
      if (result && typeof result.lastReceiptNumber === "number") {
        callback(result.lastReceiptNumber);
      } else {
        setLastReceiptNumber(1, () => {
          callback(1);
        });
      }
    };

    req.onerror = function () {
      callback(1);
    };
  });
}

function setLastReceiptNumber(value, onComplete = null) {
  if (typeof value !== 'number' || isNaN(value) || value <= 0) return;
  openReceiptDB(function (db) {
    const tx = db.transaction(receiptStoreName, 'readwrite');
    const store = tx.objectStore(receiptStoreName);
    store.put({ id: 1, lastReceiptNumber: value });
    tx.oncomplete = function () {
      if (onComplete) onComplete();
    };
  });
}

// ุนุฑุถ ุงูุฑูู ูุจุงุดุฑุฉ ูู ุญูู ุฑูู ุงููุตู ุนูุฏ ุงูุฏุฎูู ูุตูุญุฉ ุงูุฏูุน
window.addEventListener('DOMContentLoaded', function () {
  const receiptInput = document.getElementById('payment-receipt-number');
  if (receiptInput) {
    getLastReceiptNumber(function (currentNumber) {
      receiptInput.value = currentNumber;
    });
  }
});

// ุนูุฏ ุงูุถุบุท ุนูู ุฒุฑ "ุฅุถุงูุฉ ุงูุฏูุนุฉ"ุ ูุชู ุญูุธ ุงูุฑูู ูุฒูุงุฏุชู
const addPaymentBtn = document.getElementById('add-payment-btn');
if (addPaymentBtn) {
  addPaymentBtn.addEventListener('click', function () {
    const receiptInput = document.getElementById('payment-receipt-number');
    const currentValue = parseInt(receiptInput.value);
    if (!isNaN(currentValue)) {
      setLastReceiptNumber(currentValue + 1);
    }
  });
}

</script>

<script>
document.getElementById('print-receipt-btn').addEventListener('click', function () {
    const receipt = document.getElementById('receipt-preview');
    if (receipt) {
        receipt.style.display = 'flex';
    }
    setTimeout(() => {
        window.print();
    }, 200);
});

</script>

<script>
document.getElementById("student-list-search").addEventListener("input", function () {
    const keyword = this.value.toLowerCase();
    const rows = document.querySelectorAll("#students-table-body tr");
    rows.forEach(row => {
        const name = row.children[0].textContent.toLowerCase();
        if (name.includes(keyword)) {
            row.style.display = "";
        } else {
            row.style.display = "none";
        }
    });
});

</script>
<script>
function printSpecificReceipt(payment) {
  const request = indexedDB.open("MyDatabase", 2);
  request.onsuccess = function (event) {
    const db = event.target.result;
    const transaction = db.transaction("students", "readonly");
    const store = transaction.objectStore("students");
    const studentRequest = store.get(payment.studentId);

    studentRequest.onsuccess = function () {
      const student = studentRequest.result;
      if (!student) return;

      const name = student.name;
      const grade = student.grade;
      const section = student.section;
      const discount = student.discount.toLocaleString();
      const receiptNumber = payment.receiptNumber;
      const date = formatDate(payment.date);
      const amount = payment.amount.toLocaleString();
      const total = student.totalAmount.toLocaleString();
      const totalAfterDiscount = student.totalAfterDiscount.toLocaleString();
      const paid = student.paidAmount.toLocaleString();
      const remaining = (student.totalAfterDiscount - student.paidAmount).toLocaleString();

      // ุงููุตู ุงูุฃูู
      document.getElementById('receipt-student-name').textContent = name;
      document.getElementById('receipt-student-grade').textContent = grade;
      document.getElementById('receipt-student-section').textContent = section;
      document.getElementById('receipt-student-discount').textContent = discount;
      document.getElementById('receipt-number').textContent = receiptNumber;
      document.getElementById('receipt-date').textContent = date;
      document.getElementById('receipt-amount').textContent = amount;
      document.getElementById('receipt-total').textContent = total;
      document.getElementById('receipt-total-after-discount').textContent = totalAfterDiscount;
      document.getElementById('receipt-total-paid').textContent = paid;
      document.getElementById('receipt-remaining').textContent = remaining;

      // ุงููุตู ุงูุซุงูู
      document.getElementById('receipt-student-name-copy').textContent = name;
      document.getElementById('receipt-student-grade-copy').textContent = grade;
      document.getElementById('receipt-student-section-copy').textContent = section;
      document.getElementById('receipt-student-discount-copy').textContent = discount;
      document.getElementById('receipt-number-copy').textContent = receiptNumber;
      document.getElementById('receipt-date-copy').textContent = date;
  
  const installment = payment.installmentNumber || "";
  document.getElementById('receipt-installment').textContent = installment;
  document.getElementById('receipt-installment-copy').textContent = installment;

      document.getElementById('receipt-amount-copy').textContent = amount;
      document.getElementById('receipt-total-copy').textContent = total;
      document.getElementById('receipt-total-after-discount-copy').textContent = totalAfterDiscount;
      document.getElementById('receipt-total-paid-copy').textContent = paid;
      document.getElementById('receipt-remaining-copy').textContent = remaining;

      // ุทุจุงุนุฉ ุจุนุฏ ุชุฃุฎูุฑ ุจุณูุท
      setTimeout(() => {
        window.print();
      }, 100);
    };
  };
}
</script>
<script>
function filterFeesData() {
    const grade = document.getElementById('fees-grade-filter').value;
    const section = document.getElementById('fees-section-filter').value;

    let request = indexedDB.open("MyDatabase", 2);
    request.onsuccess = function(event) {
        const db = event.target.result;
        const tx = db.transaction(['students', 'payments'], 'readonly');
        const studentStore = tx.objectStore('students');
        const paymentStore = tx.objectStore('payments');

        const getAllStudents = studentStore.getAll();
        const getAllPayments = paymentStore.getAll();

        getAllStudents.onsuccess = function() {
            getAllPayments.onsuccess = function() {
                const students = getAllStudents.result;
                const payments = getAllPayments.result;

                const filteredStudents = students.filter(s =>
                    (grade === '' || s.grade === grade) &&
                    (section === '' || s.section === section)
                );

                // โ ุงูุชุฑุชูุจ ุญุณุจ ุงูุตู ุซู ุงูุงุณู
                filteredStudents.sort((a, b) => {
                    const gradeComp = a.grade.localeCompare(b.grade, 'ar');
                    return gradeComp !== 0 ? gradeComp : a.name.localeCompare(b.name, 'ar');
                });

                const tbody = document.getElementById('fees-data-body');
                tbody.innerHTML = '';

                filteredStudents.forEach((student, index) => {
                    const paid = student.paidAmount || 0;
                    const remaining = student.totalAfterDiscount - paid;

                    const studentPayments = payments.filter(p => p.studentId === student.id);
                    const lastPaymentDate = studentPayments.length
                        ? new Date(Math.max(...studentPayments.map(p => new Date(p.date)))).toLocaleDateString()
                        : 'โ';

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-4 py-2 font-bold">${index + 1}</td>
                        <td class="px-4 py-2">${student.name}</td>
                        <td class="px-4 py-2">${student.grade}</td>
                        <td class="px-4 py-2">${student.section}</td>
                        <td class="px-4 py-2">${student.totalAfterDiscount.toLocaleString()} ุฏููุงุฑ</td>
                        <td class="px-4 py-2">${paid.toLocaleString()} ุฏููุงุฑ</td>
                        <td class="px-4 py-2">${remaining.toLocaleString()} ุฏููุงุฑ</td>
                        <td class="px-4 py-2">${lastPaymentDate}</td>
                    `;
                    tbody.appendChild(row);
                });
            };
        };
    };
}
</script>
<script>
// ุชูุนูู ุงูุชุจููุจุงุช ูุชุญููู ุงููุญุชูู ุงูููุงุณุจ
document.querySelectorAll('.tab-btn').forEach(button => {
    button.addEventListener('click', () => {
        const tabId = button.getAttribute('data-tab');

        // ุฅุฎูุงุก ุฌููุน ุงูุชุจููุจุงุช
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });

        // ุฅุฒุงูุฉ ุงูุชูุนูู ูู ุฌููุน ุงูุฃุฒุฑุงุฑ
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });

        // ุชูุนูู ุงูุชุจููุจุฉ ุงููุฎุชุงุฑุฉ
        button.classList.add('active');
        const tabContent = document.getElementById(tabId);
        if (tabContent) {
            tabContent.classList.add('active');
        }

        // ุชุญููู ุงูุจูุงูุงุช ุญุณุจ ุงูุชุจููุจุฉ ุงููุฎุชุงุฑุฉ
        switch (tabId) {
            case 'add-student':
                if (typeof loadStudentsAndUpdateTable === 'function') {
                    loadStudentsAndUpdateTable();
                }
                break;

            case 'fees-data':
                if (typeof filterFeesData === 'function') {
                    filterFeesData();
                }
                break;

            case 'statistics':
                if (typeof updateStatistics === 'function') {
                    updateStatistics();
                }
                break;

            case 'pay-fees':
                // ูุง ุชูุฌุฏ ุฏุงูุฉ ูุจุงุดุฑุฉุ ูููู ุชุญููู ุฃู ุดูุก ุนูุฏ ุงูุญุงุฌุฉ
                break;

            default:
                // ูุง ุดูุก
                break;
        }
    });
});
</script>
<script>
    // ุชุฃููุฏ ุญุฐู ุงูุทุงูุจ
    function confirmDeleteStudent(studentId) {
        if (!confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงูุทุงูุจุฉ")) return;

        const transaction = db.transaction(["students"], "readwrite");
        const store = transaction.objectStore("students");

        // ุชุญููู ุงููุนุฑู ุฅูู ูุต ููุชุฃูุฏ ูู ุงูุชูุงูู
        const request = store.delete(String(studentId));

        request.onsuccess = function () {
            alert("ุชู ุญุฐู ุงูุทุงูุจุฉ ุจูุฌุงุญ");
            loadStudentsAndUpdateTable();
        };

        request.onerror = function (event) {
            console.error("ุฎุทุฃ ุฃุซูุงุก ุญุฐู ุงูุทุงูุจุฉ:", event.target.error);
            alert("ูุดู ูู ุญุฐู ุงูุทุงูุจุฉ");
        };
    }
</script>

 



<script>
function filterPaymentReports() {
    const grade = document.getElementById('report-grade').value;
    const section = document.getElementById('report-section').value;
    const status = document.getElementById('report-status').value;

    const request = indexedDB.open("MyDatabase", 2);
    request.onsuccess = function (event) {
        const db = event.target.result;

        const studentTx = db.transaction("students", "readonly");
        const studentStore = studentTx.objectStore("students");
        const studentReq = studentStore.getAll();

        const paymentTx = db.transaction("payments", "readonly");
        const paymentStore = paymentTx.objectStore("payments");
        const paymentReq = paymentStore.getAll();

        studentReq.onsuccess = function () {
            paymentReq.onsuccess = function () {
                const students = studentReq.result;
                const payments = paymentReq.result;

                const now = new Date();
                const thisMonth = now.getMonth();
                const thisYear = now.getFullYear();

                const reportBody = document.getElementById("report-table-body");
                reportBody.innerHTML = "";

                students.forEach(student => {
                    if (grade && student.grade !== grade) return;
                    if (section && student.section !== section) return;

                    const studentPayments = payments.filter(p => p.studentId === student.id);
                    if (studentPayments.length === 0 && status === "paid") return;

                    const lastPayment = studentPayments.sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                    let lastDate = lastPayment ? new Date(lastPayment.date) : null;

                    const diffDays = lastDate ? Math.floor((now - lastDate) / (1000 * 60 * 60 * 24)) : null;
                    const paidThisMonth = lastDate && lastDate.getMonth() === thisMonth && lastDate.getFullYear() === thisYear;

                    if (status === "paid" && !paidThisMonth) return;
                    if (status === "unpaid" && paidThisMonth) return;

                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td class="px-4 py-2">${student.name}</td>
                        <td class="px-4 py-2">${student.grade}</td>
                        <td class="px-4 py-2">${student.section}</td>
                        <td class="px-4 py-2">${lastPayment ? lastPayment.amount.toLocaleString() + ' ุฏููุงุฑ' : '-'}</td>
                        <td class="px-4 py-2">${lastDate ? lastDate.toLocaleDateString() : '-'}</td>
                        <td class="px-4 py-2">${diffDays !== null ? diffDays : '-'}</td>
                    `;
                    reportBody.appendChild(row);
                });
            };
        };
    };
}

function printReportToWord() {
    const table = document.getElementById("report-table").outerHTML;
    const header = "<h2 style='text-align:right'>ุชูุฑูุฑ ุชูุณูุท ุงูุทูุงุจ</h2>";
    const style = `
        <style>
            table { border-collapse: collapse; width: 100%; direction: rtl; font-family: 'Tahoma'; }
            th, td { border: 1px solid #000; padding: 8px; text-align: right; }
            th { background-color: #f2f2f2; }
        </style>
    `;
    const html = '<html><head><meta charset="utf-8">' + style + '</head><body>' + header + table + '</body></html>';
    const blob = new Blob(['๏ปฟ', html], { type: 'application/msword' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.href = url;
    link.download = "ุชูุฑูุฑ_ุงูุทูุงุจ.doc";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
</script>

</body>
</html>